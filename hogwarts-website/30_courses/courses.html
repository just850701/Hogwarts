<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>課程</title>
  <link rel="stylesheet" href="../css/bootstrap.css" />
  <script src="../js/bootstrap.bundle.js"></script>
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.3.1/css/hover-min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
  <style>
    .hero {
      background-image: url('../img/bg_potion.jpg');
    }
  </style>
</head>

<body>
  <header>
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid px-0 d-flex align-items-center">
        <a class="navbar-brand ms-3" href="../index.html" style="height: 40px;">
          <img src="../img/hogwarts_LOGO.png" alt="Hogwarts Logo" style="height: 100%;">
        </a>
        <ul class="navbar-nav mx-auto d-flex flex-row" style="list-style: none;">
          <li class="nav-item"><a class="nav-link" href="../10_houses/houses.html">學院</a></li>
          <li class="nav-item"><a class="nav-link" href="../20_professor/professor.html">師資</a></li>
          <li class="nav-item"><a class="nav-link" href="../30_courses/courses.html">課程</a></li>
          <li class="nav-item"><a class="nav-link" href="../40_activities/activities.html">活動</a></li>
          <li class="nav-item"><a class="nav-link" href="../50_alumni/alumni.html">交通</a></li>
          <li class="nav-item"><a class="nav-link" href="../60_test/test.html">分院測驗</a></li>
        </ul>
        <!-- 登入區 -->
        <div id="login-area" class="mx-4 text-light"></div>
      </div>
    </nav>

  </header>

  <main>
    <!-- Hero 區 -->
    <section class="hero d-flex justify-content-center align-items-center text-center text-light">
      <div class="fog"></div>
      <div class="hero-text">
        <h1 class="fw-bold text-warning py-2">課程介紹</h1>
        <p>魔法與現實交織的知識探索，掌握元素魔法與古老符文。</p>
      </div>
    </section>
    <div class="magic-divider"></div>

    <!-- 搜尋欄和新增課程按鈕 -->
    <div class="container mt-4">
      <div class="row justify-content-center">
        <!-- 搜尋欄 -->
        <div class="col-md-6 mb-2">
          <input type="text" class="form-control" placeholder="搜尋課程..." id="search-course-input" />
        </div>

        <!-- 新增課程按鈕 -->
        <div class="col-md-2 mb-2 text-md-start text-center">
          <button class="btn btn-outline-warning w-100" id="add-course-btn" type="button">新增課程</button>
        </div>
      </div>
    </div>



    <!-- 課程卡片容器 -->
    <div class="container mt-4">
      <div class="row justify-content-center" id="courses-container">
        <!-- JS 動態載入卡片 -->
      </div>
    </div>
  </main>

  <br /><br /><br />

  <a href="#" class="back-to-top" data-aos="fade-up">
    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor"
      class="bi bi-arrow-up-circle text-white text-opacity-75" viewBox="0 0 16 16">
      <path fill-rule="evenodd"
        d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707z" />
    </svg>
  </a>

  <footer class="text-center text-light py-4">
    <p>© 2025 霍格華茲魔法學校. All rights reserved.</p>
    <p class="fst-italic">「別忘了檢查你的貓頭鷹郵件信箱！」</p>
  </footer>

  <!-- 星星背景動畫 -->
  <div id="particles-js"></div>
  <script>
    tsParticles.load("particles-js", {
      background: { color: "#10141b" },
      particles: {
        number: { value: 50 },
        color: { value: "#d2aa6b" },
        shape: { type: "star" },
        opacity: { value: 0.8 },
        size: { value: 2 },
        move: { enable: true, speed: 0.3, direction: "none", random: true, straight: false }
      },
      fullScreen: { enable: true, zIndex: -1 }
    });

    // 載入課程資料並加上即時搜尋功能（無搜尋按鈕）
    fetch('../getinfo/get_courses.php')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('courses-container');
        const searchInput = document.querySelector('.form-control');
        const allCards = [];

        data.forEach(course => {
          const col = document.createElement('div');
          col.className = 'col-md-4 mb-4';
          col.style.width = "350px";

          col.innerHTML = `
        <div class="card img-fluid hvr-grow" style="width:100%">
          <img class="card-img-top" src="../img/${course.image}" alt="${course.cname}">
          <div class="card-body text-center">
            <h4 class="card-title text-warning">${course.cname}</h4>
            <h5 class="card-text text-white">${course.description || ''}</h5>
          </div>
        </div>
      `;
          container.appendChild(col);
          allCards.push({
            element: col,
            name: course.cname,
            description: course.description || ''
          });
        });

        // ✅ 即時搜尋功能（輸入自動篩選）
        searchInput.addEventListener('input', (e) => {
          const keyword = e.target.value.trim().toLowerCase();
          allCards.forEach(({ element, name, description }) => {
            const combinedText = `${name} ${description}`.toLowerCase();
            const isMatch = combinedText.includes(keyword);
            element.style.display = isMatch ? '' : 'none';
          });
        });
      })
      .catch(error => {
        console.error('課程資料載入失敗：', error);
      });

    // auth.js

    document.addEventListener("DOMContentLoaded", () => {
      const loginArea = document.getElementById("login-area");
      const professorName = localStorage.getItem("professorName");

      if (professorName) {
        // ✅ 已登入狀態，顯示名稱＋登出
        loginArea.innerHTML = `
      <span class="me-2">👨‍🏫 ${professorName}</span>
      <button id="logout-btn" class="btn btn-sm btn-outline-light">登出</button>
    `;

        document.getElementById("logout-btn").addEventListener("click", () => {
          if (confirm("確定要登出嗎？")) {
            localStorage.removeItem("professorName");
            location.reload(); // 重新整理頁面
          }
        });

      } else {
        // ❌ 未登入狀態，顯示登入按鈕
        loginArea.innerHTML = `
      <a href="../login/login.html" class="btn btn-sm btn-outline-warning">登入</a>
    `;
      }
    });

    // ✅ 新增課程按鈕功能
    document.addEventListener("DOMContentLoaded", () => {
      const addCourseBtn = document.getElementById("add-course-btn");
      if (addCourseBtn) {
        addCourseBtn.addEventListener("click", () => {
          const professorName = localStorage.getItem("professorName");
          if (professorName) {
            // ✅ 已登入，導向新增課程頁
            window.location.href = "../getinfo/add_course.html";
          } else {
            // ❌ 未登入，導向登入頁並加上 returnUrl
            alert("請先登入！");
            window.location.href = "../login/login.html";
          }
        });
      }
    });


  </script>

  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init();
  </script>
  <script src="./js/auth.js"></script>

</body>

</html>